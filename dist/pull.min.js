!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Pull=e()}(this,function(){var o,e,i,n,l,s,a,r={text:'@-webkit-keyframes bb_animate-rotate{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes bb_animate-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes bb_animate-load{0%{opacity:.2}100%{opacity:1}}@keyframes bb_animate-load{0%{opacity:.2}100%{opacity:1}}.bb_pull{text-align:center;display:box;display:-webkit-box;display:-moz-box;-webkit-box-pack:center;-moz-box-pack:center;-webkit-box-align:center;-moz-box-align:center}.bb_pull-inner *{margin:0;padding:0;-webkit-box-sizing:content-box;box-sizing:content-box}.bb_pull-inner{font:14px/1.42857143 "Lucida Grande",Verdana,"Microsoft YaHei",hei;-webkit-font-smoothing:antialiased;color:#333}.bb_pull-icon{display:inline-block;vertical-align:middle}.bb_pull-icon_loading{position:relative;width:10px;height:10px;border:2px solid #009def;border-right-color:transparent;border-radius:50%}.bb_pull-icon_loadFailed{position:relative;width:14px;height:14px}.bb_pull-icon_loadFailed:after,.bb_pull-icon_loadFailed:before{content:"";position:absolute;left:6px;top:0;width:2px;height:14px;background:#ee693b;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.bb_pull-icon_loadFailed:after{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.bb_pull-icon_loadSuccess{display:inline-block;width:12px;height:6px;vertical-align:-3px;border:2px solid #13b418;border-width:0 0 2px 2px;-webkit-transform:translate(0,-5px) rotate(-45deg);transform:translate(0,-5px) rotate(-45deg)}.bb_pull-animate_rotate{-webkit-animation:bb_animate-rotate 1s linear 0s infinite;animation:bb_animate-rotate 1s linear 0s infinite}.bb_pull-icon_loading_ios{position:relative;width:24px;height:24px}.bb_pull-icon_loading_ios-line div{position:absolute;left:11px;top:0;width:2px;height:24px}.bb_pull-icon_loading_ios-line div:after,.bb_pull-icon_loading_ios-line div:before{content:"";display:block;height:30%;background:#777;border-radius:5px}.bb_pull-icon_loading_ios-line div:after{margin-top:10px}.bb_pull-icon_loading_ios-line div:nth-child(2){-webkit-transform:rotate(30deg);transform:rotate(30deg)}.bb_pull-icon_loading_ios-line div:nth-child(3){-webkit-transform:rotate(60deg);transform:rotate(60deg)}.bb_pull-icon_loading_ios-line div:nth-child(4){-webkit-transform:rotate(90deg);transform:rotate(90deg)}.bb_pull-icon_loading_ios-line div:nth-child(5){-webkit-transform:rotate(120deg);transform:rotate(120deg)}.bb_pull-icon_loading_ios-line div:nth-child(6){-webkit-transform:rotate(150deg);transform:rotate(150deg)}.bb_pull-icon_loading_ios-line div:nth-child(1):before{-webkit-animation:bb_animate-load 1.2s linear 0s infinite;animation:bb_animate-load 1.2s linear 0s infinite}.bb_pull-icon_loading_ios-line div:nth-child(2):before{-webkit-animation:bb_animate-load 1.2s linear .1s infinite;animation:bb_animate-load 1.2s linear .1s infinite}.bb_pull-icon_loading_ios-line div:nth-child(3):before{-webkit-animation:bb_animate-load 1.2s linear .2s infinite;animation:bb_animate-load 1.2s linear .2s infinite}.bb_pull-icon_loading_ios-line div:nth-child(4):before{-webkit-animation:bb_animate-load 1.2s linear .3s infinite;animation:bb_animate-load 1.2s linear .3s infinite}.bb_pull-icon_loading_ios-line div:nth-child(5):before{-webkit-animation:bb_animate-load 1.2s linear .4s infinite;animation:bb_animate-load 1.2s linear .4s infinite}.bb_pull-icon_loading_ios-line div:nth-child(6):before{-webkit-animation:bb_animate-load 1.2s linear .5s infinite;animation:bb_animate-load 1.2s linear .5s infinite}.bb_pull-icon_loading_ios-line div:nth-child(1):after{-webkit-animation:bb_animate-load 1.2s linear .6s infinite;animation:bb_animate-load 1.2s linear .6s infinite}.bb_pull-icon_loading_ios-line div:nth-child(2):after{-webkit-animation:bb_animate-load 1.2s linear .7s infinite;animation:bb_animate-load 1.2s linear .7s infinite}.bb_pull-icon_loading_ios-line div:nth-child(3):after{-webkit-animation:bb_animate-load 1.2s linear .8s infinite;animation:bb_animate-load 1.2s linear .8s infinite}.bb_pull-icon_loading_ios-line div:nth-child(4):after{-webkit-animation:bb_animate-load 1.2s linear .9s infinite;animation:bb_animate-load 1.2s linear .9s infinite}.bb_pull-icon_loading_ios-line div:nth-child(5):after{-webkit-animation:bb_animate-load 1.2s linear 1s infinite;animation:bb_animate-load 1.2s linear 1s infinite}.bb_pull-icon_loading_ios-line div:nth-child(6):after{-webkit-animation:bb_animate-load 1.2s linear 1.1s infinite;animation:bb_animate-load 1.2s linear 1.1s infinite}.bb_pull-inner{padding:5px}.bb_pull-up .bb_pull-inner{padding:10px}.bb_pull-icon_loading_ios{display:inline-block;vertical-align:middle;margin-right:-6px;-webkit-transform:scale(.75);transform:scale(.75)}.bb_pull-text{margin:0 5px;line-height:24px;vertical-align:middle;color:#777}',id:"_bb_pull_style",isLoad:!1,_dom:null,load:function(){this.isLoad||(this._dom=document.createElement("style"),this._dom.innerHTML=this.text,this._dom.setAttribute("id",this.id),document.head.appendChild(this._dom),this.isLoad=!0)},remove:function(){this.isLoad&&(document.head.removeChild(this._dom),this.isLoad=!1)}},c={isSupportTouch:"ontouchstart"in window,getScrollTop:function(t){return t===document.body||t===document.documentElement||t===window?Math.max(document.body.scrollTop,document.documentElement.scrollTop):t.scrollTop},extend:(e=Object.prototype.toString,i=Object.prototype.hasOwnProperty,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Object]":"object"},l=function(t){return null==t?String(t):n[e.call(t)]||"object"},s=function(t){return t&&"object"==typeof t&&"setInterval"in t},a=Array.isArray||function(t){return"array"===l(t)},p)};function d(t){if(t&&"object"===l(t)&&!t.nodeType&&!s(t)&&(!t.constructor||i.call(t,"constructor")||i.call(t.constructor.prototype,"isPrototypeOf"))){for(var e in t);return void 0===e||i.call(t,e)}}function p(t,e,i){for(name in i)src=e[name],e!==(copy=i[name])&&(t&&copy&&(d(copy)||(o=a(copy)))?(clone=o?(o=!1,src&&a(src)?src:[]):src&&d(src)?src:{},e[name]=p(t,clone,copy)):void 0!==copy&&(e[name]=copy));return e}var h={start:c.isSupportTouch?"touchstart":"mousedown",move:c.isSupportTouch?"touchmove":"mousemove",end:c.isSupportTouch?"touchend":"mouseup",cancel:"touchcancel"},u={start:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading"></i><span class="bb_pull-text"><%=text%></span></div>',drop:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading"></i><span class="bb_pull-text"><%=text%></span></div>',loading:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading bb_pull-animate_rotate"></i><span class="bb_pull-text"><%=text%></span></div>',success:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loadSuccess"></i><span class="bb_pull-text"><%=text%></span></div>',failed:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loadFailed"></i><span class="bb_pull-text"><%=text%></span></div>'},b={start:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>',loading:'<div class="bb_pull-inner"><div class="bb_pull-icon"><div class="bb_pull-icon_loading_ios"><div class="bb_pull-icon_loading_ios-line"><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div><span class="bb_pull-text"><%=text%></span></div>',failed:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>',done:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>'};function f(t){this.allowState=["start","drop","loading","success","failed"],this.state=this.allowState[0],this.init(t)}function m(t){this.allowState=["start","loading","failed","done"],this.state=this.allowState[0],this.init(t)}f.prototype.init=function(t){if(this.options=c.extend(!0,{scrollView:"",classname:"bb_pull bb_pull-down",text:{start:"下拉刷新",drop:"释放刷新",loading:"刷新中...",success:"刷新成功",failed:"刷新失败"},dom:{}},t),!this.options.scrollView)throw"scrollView undefined";this.scrollView=this.options.scrollView,this.wrapperView=this.scrollView.parentNode,this.initTpls(),this.create(),this.render()},f.prototype.initTpls=function(){var t="<%=text%>",e=c.extend({},u,this.options.dom),i=this.options.text;this.tpls={start:e.start.replace(t,i.start),drop:e.drop.replace(t,i.drop),loading:e.loading.replace(t,i.loading),success:e.success.replace(t,i.success),failed:e.failed.replace(t,i.failed)}},f.prototype.create=function(){this.element=document.createElement("div"),this.element.className=this.options.classname,this.element.style.height="0px",this.element.style.overflow="hidden",this.element.innerHTML=this.tpls[this.state]},f.prototype.render=function(){this.wrapperView.insertBefore(this.element,this.scrollView)},f.prototype.setState=function(t){if(this.state!==t){if(-1===this.allowState.indexOf(t))throw"RefreshView 不支持 "+t+" 状态";this.state=t,this.element.innerHTML=this.tpls[this.state]}},f.prototype.enabledAnimate=function(t){this.element.style.webkitTransition=t?"all 300ms":"",this.element.style.transition=t?"all 300ms":""},f.prototype.height=function(t){if("number"!=typeof t)return this.element.clientHeight;this.element.style.height=t+"px"},f.prototype.show=function(t){this.element.style.display="block"},f.prototype.hide=function(t){this.element.style.display="none"},f.prototype.destroy=function(){this.wrapperView.removeChild(this.element)},m.prototype.init=function(t){if(this.options=c.extend(!0,{scrollView:"",classname:"bb_pull bb_pull-up",text:{start:"上拉加载更多",loading:"正在加载",failed:"加载失败，点击重试",done:"已全部加载"},dom:{},onClick:null},t),!this.options.scrollView)throw"scrollView undefined";this.scrollView=this.options.scrollView,this.wrapperView=this.scrollView.parentNode,this.initTpls(),this.create(),this.bind(),this.render()},m.prototype.initTpls=function(){var t="<%=text%>",e=c.extend({},b,this.options.dom),i=this.options.text;this.tpls={start:e.start.replace(t,i.start),loading:e.loading.replace(t,i.loading),failed:e.failed.replace(t,i.failed),done:e.done.replace(t,i.done)}},m.prototype.create=function(){this.element=document.createElement("div"),this.element.className=this.options.classname,this.element.innerHTML=this.tpls[this.state]},m.prototype.bind=function(){var e=this.options.onClick;this.element.addEventListener("click",function(t){"function"==typeof e&&e(t)})},m.prototype.render=function(){this.wrapperView.appendChild(this.element)},m.prototype.setState=function(t){if(this.state!==t){if(-1===this.allowState.indexOf(t))throw"ScrollBottomLoadView 不支持 "+t+" 状态";this.state=t,this.element.innerHTML=this.tpls[this.state]}},m.prototype.height=function(t){if("number"!=typeof t)return this.element.clientHeight;this.element.style.height=t+"px"},m.prototype.show=function(t){this.element.style.display="block"},m.prototype.hide=function(t){this.element.style.display="none"},m.prototype.destroy=function(){this.wrapperView.removeChild(this.element)};var _=0;function t(t,e){var i=this;i.element=document.getElementById(t),i.touchesStart={},i.touchesDiff=0,i.isHorizontalScrolling=void 0,i.isTouch=!1,i.isMove=!1,i.isLoading=!1,i.isLockUp=!1,i.isLockDown=!1,i.isDone=!1,i.__timerFixSlideOutScreen=null,i.init(e)}function g(t){var e;t.opts.autoLoad&&t.opts.onPullUp&&(e=c.getScrollTop(t.scrollArea),t._scrollContentHeight-t.opts.threshold<=t._scrollAreaHeight+e&&t.triggerPullUp())}function w(e){if(!e.touches)try{e.touches=e.originalEvent.touches}catch(t){e.touches=[{pageX:e.pageX,pageY:e.pageY}]}}function v(t,e){e=e||this;clearTimeout(e.__timerFixSlideOutScreen),e.isTouch&&e.isMove?(e.isTouch=!1,e.isMove=!1,e.refreshView.enabledAnimate(!0),e.touchesDiff>e.opts.distance?e.triggerPullDown():e.refreshView.height(0)):(e.isTouch=!1,e.isMove=!1,e.isLoading||0===e.refreshView.height()||(e.refreshView.enabledAnimate(!1),e.refreshView.height(0)))}function y(t){t=t||this;setTimeout(function(){t.refreshView.enabledAnimate(!0),t.refreshView.height(0),setTimeout(function(){t.isLoading=!1,t.updateScrollContentHeight(),t.refreshView.setState("start")},300)},500)}function x(t){0!==(t=t||this).refreshView.height()&&(t.refreshView.enabledAnimate(!1),t.refreshView.height(0),t.refreshView.setState("start"))}return t.prototype.init=function(t){var e,i=this;if(i.__isInit)return i;function o(){var t,e;i.isLoading||i.isLockDown||i.isDone||(t=c.getScrollTop(i.scrollArea),e=i.scrollBottomLoadView.state,i._scrollContentHeight-i.opts.threshold<=i._scrollAreaHeight+t&&i.opts.autoLoad&&"failed"!==e&&i.triggerPullUp())}_++,i.__isInit=!0,i.opts=c.extend(!0,{scrollArea:"",lock:!1,distance:50,onPullDown:null,pullDownText:{start:"下拉刷新",drop:"释放刷新",loading:"刷新中...",success:"刷新成功",failed:"刷新失败"},onPullUp:null,autoLoad:!0,threshold:100,pullUpText:{start:"上拉加载更多",loading:"正在加载",failed:"加载失败，点击重试",done:"已全部加载"},pullDownDom:{},pullUpDom:{}},t),i.opts.scrollAreaId&&"string"==typeof i.opts.scrollAreaId?i.scrollArea=document.getElementById(i.opts.scrollAreaId):i.scrollArea=document.documentElement,(i.opts.onPullDown||i.opts.onPullUp)&&(i.opts.autoLoad||"上拉加载更多"!==i.opts.pullUpText.start||(i.opts.pullUpText.start="点击加载更多"),r.load(),i._scrollContentHeight=i.element.scrollHeight,i._scrollAreaHeight=i.scrollArea.clientHeight,i.opts.onPullDown&&(i.refreshView=new f({scrollView:i.element,text:i.opts.pullDownText,dom:i.opts.pullDownDom}),i.opts.lock&&i.lock("up"),i.element.addEventListener(h.start,function(t){w(t),function(t,e){(e=e||this).isLoading||(0<c.getScrollTop(e.scrollArea)||e.isLoading||e.isLockUp?e.isTouch=!1:(e.isTouch=!0,e.isMove=!1,e.isHorizontalScrolling=void 0,e.touchesStart.x=t.touches[0].pageX,e.touchesStart.y=t.touches[0].pageY))}(t,i)}),i.element.addEventListener(h.move,function(t){w(t),function(t,e){if((e=e||this).isTouch){var i=t.touches[0].pageX,o=t.touches[0].pageY;if(!e.isMove){if(void 0===e.isHorizontalScrolling&&(e.isHorizontalScrolling=!!(e.isHorizontalScrolling||Math.abs(o-e.touchesStart.y)<=Math.abs(i-e.touchesStart.x))),e.isHorizontalScrolling||e.isLockUp)return e.isTouch=!1;e.isMove=!0}t.preventDefault(),e.touchesDiff=o-e.touchesStart.y,clearTimeout(e.__timerFixSlideOutScreen),e.__timerFixSlideOutScreen=setTimeout(function(){v(0,e)},1e3),e.refreshView.enabledAnimate(!1);i=0;e.touchesDiff<=e.opts.distance?(i=e.touchesDiff,e.refreshView.setState("start")):e.touchesDiff>e.opts.distance&&e.touchesDiff<=2*e.opts.distance?(i=e.opts.distance+.5*(e.touchesDiff-e.opts.distance),e.refreshView.setState("drop")):i=e.opts.distance+.5*e.opts.distance+.2*(e.touchesDiff-2*e.opts.distance),e.refreshView.height(Math.max(i,0))}}(t,i)}),i.element.addEventListener(h.end,function(t){v(0,i)}),i.element.addEventListener(h.cancel,function(t){v()})),i.opts.onPullUp&&(i.scrollBottomLoadView=new m({scrollView:i.element,text:i.opts.pullUpText,dom:i.opts.pullUpDom,onClick:function(t){var e=i.scrollBottomLoadView.state;"done"===e||"loading"===e||"failed"!==e&&i.opts.autoLoad||i.triggerPullUp()}}),i.opts.lock&&i.lock("down"),g(i),e=null,window.addEventListener("resize",function(t){clearTimeout(e),e=setTimeout(function(){i.updateScrollAreaHeight()},300)}),(i.scrollArea===document||i.scrollArea===document.body||i.scrollArea===document.documentElement?window:i.scrollArea).addEventListener("scroll",o)))},t.prototype.updateScrollContentHeight=function(){this._scrollContentHeight=this.element.scrollHeight,g(this)},t.prototype.updateScrollAreaHeight=function(){this._scrollAreaHeight=this.scrollArea.clientHeight,g(this)},t.prototype.pullDownFailed=function(){this.refreshView.setState("failed"),y(this)},t.prototype.pullDownSuccess=function(){this.refreshView.setState("success"),y(this)},t.prototype.triggerPullDown=function(){var t=this;t.isLoading=!0,t.refreshView.setState("loading"),t.refreshView.height(t.opts.distance),t.opts.onPullDown()},t.prototype.pullUpFailed=function(){this.scrollBottomLoadView.setState("failed"),this.isLoading=!1},t.prototype.pullUpSuccess=function(){this.isLoading=!1,this.scrollBottomLoadView.setState("start"),this.updateScrollContentHeight()},t.prototype.pullUpDone=function(){this.isLoading=!1,this.isDone=!0,this.scrollBottomLoadView.setState("done"),this.updateScrollContentHeight()},t.prototype.resetPullUpDone=function(){this.isDone=!1},t.prototype.triggerPullUp=function(){var t=this;t.isDone||t.isLockDown||t.isLoading||(t.isLoading=!0,t.scrollBottomLoadView.setState("loading"),t.opts.onPullUp())},t.prototype.lock=function(t){var e=this;!t||"up"!==t&&"down"!==t?(e.isLockDown=!0,e.isLockUp=!0,e.onPullDown&&(x(e),e.refreshView.hide()),e.onPullUp&&(e.scrollBottomLoadView.setState("start"),e.scrollBottomLoadView.hide())):"up"===t?(e.isLockUp=!0,e.onPullDown&&(x(e),e.refreshView.hide())):(e.isLockDown=!0,e.onPullUp&&(e.scrollBottomLoadView.setState("start"),e.scrollBottomLoadView.hide()))},t.prototype.unlock=function(t){var e=this;!t||"up"!==t&&"down"!==t?(e.isLockDown=!1,e.isLockUp=!1,e.onPullDown&&e.refreshView.show(),e.onPullUp&&(e.scrollBottomLoadView.show(),e.updateScrollContentHeight())):"up"===t?(e.isLockUp=!1,e.onPullDown&&e.refreshView.show()):(e.isLockDown=!1,e.onPullUp&&(e.scrollBottomLoadView.show(),e.updateScrollContentHeight()))},t.prototype.destroy=function(){var t=this;--_<=0&&r.remove(),t.lock(),t.refreshView&&t.refreshView.destroy(),t.scrollBottomLoadView&&t.scrollBottomLoadView.destroy()},t});